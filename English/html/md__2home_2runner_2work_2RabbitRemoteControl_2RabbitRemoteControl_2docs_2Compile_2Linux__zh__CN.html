<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Rabbit Remote Control: 为 Linux 编译</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="app.ico"/></td>
  <td id="projectalign">
   <div id="projectname">Rabbit Remote Control<span id="projectnumber">&#160;0.1.0-bate7</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">为 Linux 编译</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md134"></a> 作者：康林 <a href="#" onclick="location.href='mai'+'lto:'+'kl2'+'22'+'@12'+'6.'+'com'; return false;">kl222<span class="obfuscator">.nosp@m.</span>@126<span class="obfuscator">.nosp@m.</span>.com</a></p>
<h2><a class="anchor" id="autotoc_md135"></a>
快速开始</h2>
<pre class="fragment"># 仅编译 AppImage
./Script/build_linux.sh --appimage
# 仅编译 deb 包
./Script/build_linux.sh --deb
# 仅编译 rpm 包
./Script/build_linux.sh --rpm
</pre><p> 详见：脚本</p>
<h2><a class="anchor" id="autotoc_md136"></a>
环境</h2>
<h3><a class="anchor" id="autotoc_md137"></a>
操作系统</h3>
<ul>
<li>Ubuntu <pre class="fragment">~$ lsb_release -a
No LSB modules are available.
Distributor ID:   Ubuntu
Description:  Ubuntu 24.04.1 LTS
Release:  24.04
Codename: noble
</pre></li>
<li>Debian <pre class="fragment">~$ lsb_release -a
No LSB modules are available.
Distributor ID:   Debian
Description:  Debian GNU/Linux 12 (bookworm)
Release:  12
Codename: bookworm
</pre></li>
<li>Fedora <pre class="fragment">$ cat /etc/redhat-release 
Fedora release 42 (Adams)
</pre> </li>
</ul>
<h3><a class="anchor" id="autotoc_md138"></a>
Qt Creator</h3>
<p>版本：v18.0.0。建议使用 v5.0.2 及以后版本，以前版本对 CMake 支持不够。</p>
<h2><a class="anchor" id="autotoc_md139"></a>
工具</h2>
<h3><a class="anchor" id="autotoc_md140"></a>
安装开发工具软件包</h3>
<pre class="fragment">  ~$ sudo apt install build-essential
</pre><ul>
<li>开发工具软件包已经包括安装以下内容：<ul>
<li>编译器<ul>
<li>GCC/G++ <pre class="fragment">~$ sudo apt install g++ gcc
</pre></li>
</ul>
</li>
<li>automake、autoconf、make、fakeroot <pre class="fragment">~$ sudo apt install automake autoconf make fakeroot
</pre></li>
</ul>
</li>
<li>动态库工具<ul>
<li>ldd: 查看动态库依赖 <pre class="fragment">ldd file
</pre></li>
<li>ldconfig: 更新动态库缓存。执行 ldconfig 命令，默认会在 /lib 和 /usr/lib 目录以及动态库配置文件 /etc/ld.so.conf 内所列出的目录下，搜索出可共享的动态链接库（格式如 lib*.so*）， 进而创建出动态装入程序（ld.so）所需的连接和缓存文件。缓存文件默认为 /etc/ld.so.cache， 此文件保存已排好序的动态链接库名字列表，为了让动态链接库为系统所共享，就需要运行动态链接库的管理命令 ldconfig。</li>
<li>readelf: 查看elf结构 <pre class="fragment">readelf -d "file"    #可查看　runPath(rpath)
</pre></li>
<li>加载动态库搜索顺序<ul>
<li>代码中指定的位置　(rpath)</li>
<li>环境变量： LD_CONFIG_PATH</li>
<li>系统库位置 (/lib、/usr/lib 等)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md141"></a>
GIT: &lt;a href="http://www.git-scm.com" &gt;http://www.git-scm.com&lt;/a&gt;</h3>
<pre class="fragment">  ~$ sudo apt install git
</pre> <h3><a class="anchor" id="autotoc_md142"></a>
CMAKE: &lt;a href="http://www.cmake.org" &gt;http://www.cmake.org&lt;/a&gt;</h3>
<p>版本: 大于 3.27.0 </p><pre class="fragment">~$ sudo apt install cmake
</pre> <h3><a class="anchor" id="autotoc_md143"></a>
打包工具: debhelper</h3>
<pre class="fragment">  ~$ sudo apt install debhelper
</pre> <h3><a class="anchor" id="autotoc_md144"></a>
Qt</h3>
<ul>
<li>Qt 官方发行版本： <a href="https://download.qt.io/official_releases/qt/">https://download.qt.io/official_releases/qt/</a> <br  />
 当前使用版本：Qt 6.9.3<ul>
<li>则需要设置环境变量（或者 CMAKE 参数）：<ul>
<li>QT_ROOT</li>
<li>Qt6：Qt6_ROOT 或者 Qt6_DIR 。 详见：https://doc.qt.io/qt-6/cmake-get-started.html</li>
<li>Qt5：Qt5_ROOT 或者 Qt5_DIR 。 详见：https://doc.qt.io/qt-5/cmake-get-started.html</li>
<li>环境变量 <pre class="fragment">export QT_ROOT=Qt 安装位置
# 编译 AppImage 需要
export QMAKE=$QT_ROOT/bin/qmake

# 当使用 Qt6 时
export Qt6_ROOT=$QT_ROOT
# 当使用 Qt5 时
export Qt5_ROOT=$QT_ROOT

# 或者
# 当使用 Qt6 时
export Qt6_DIR=$QT_ROOT/lib/cmake/Qt6
# 当使用 Qt5 时
export Qt5_DIR=$QT_ROOT/lib/cmake/Qt5
</pre></li>
<li>CMAKE 参数 <pre class="fragment">#当使用 Qt6 时
cmake -DQT_ROOT=[Qt 安装位置] -DQt6_DIR=[Qt 安装位置] ......
#当使用 Qt5 时
cmake -DQT_ROOT=[Qt 安装位置] -DQt5_DIR=[Qt 安装位置] ......
# 编译 AppImage 需要
export QMAKE=$QT_ROOT/bin/qmake
</pre></li>
</ul>
</li>
</ul>
</li>
<li>系统自带：<ul>
<li>Qt5: <pre class="fragment">~$ sudo apt install qttools5-dev qttools5-dev-tools qtbase5-dev qtbase5-dev-tools qtmultimedia5-dev qtlocation5-dev libqt5svg5-dev libqtermwidget5-0-dev
</pre></li>
<li>Qt6: 详见： <a href="../../Script/build_depend.sh">Script/build_depend.sh</a> <pre class="fragment">~$ sudo apt install qmake6 qt6-tools-dev qt6-tools-dev-tools qt6-base-dev qt6-base-dev-tools qt6-qpa-plugins libqt6svg6-dev qt6-l10n-tools qt6-translations-l10n qt6-scxml-dev qt6-multimedia-dev libqt6serialport6-dev
</pre></li>
<li>系统安装多个分发版本 Qt 时。例如：同时安装 Qt5 和 Qt6 。 系统使用 qtchooser 工具来选择当前的 Qt 版本。 <pre class="fragment">l@l:/home/RabbitRemoteControl$ qtchooser 
Usage:
  qtchooser { -l | -list-versions | -print-env }
  qtchooser -install [-f] [-local] &lt;name&gt; &lt;path-to-qmake&gt;
  qtchooser -run-tool=&lt;tool name&gt; [-qt=&lt;Qt version&gt;] [program arguments]
  &lt;executable name&gt; [-qt=&lt;Qt version&gt;] [program arguments]
Environment variables accepted:
  QTCHOOSER_RUNTOOL  name of the tool to be run (same as the -run-tool argument)
  QT_SELECT          version of Qt to be run (same as the -qt argument)
</pre><ul>
<li>查看当前系统安装的 Qt 版本 <pre class="fragment">l@l:/home/RabbitRemoteControl$ qtchooser -l
4
5
default
qt4-x86_64-linux-gnu
qt4
qt5-x86_64-linux-gnu
qt5
qt6

# 查看当前环境的 Qt 版本
l@l:/home/RabbitRemoteControl$ qtchooser --print-env
QT_SELECT="default"
QTTOOLDIR="[Paths]"
QTLIBDIR="Prefix=/usr"
</pre></li>
<li>设置当前环境的 Qt 版本 <pre class="fragment">export QT_SELECT=qt6  #设置当前环境 Qt 版本为 6

# 查看当前环境的 Qt 版本
l@l:/home/RabbitRemoteControl$ qtchooser --print-env
QT_SELECT="qt6"
QTTOOLDIR="/usr/lib/qt6/bin"
QTLIBDIR="/usr/lib/aarch64-linux-gnu"
</pre></li>
</ul>
</li>
<li>QtWebEngine 默认情况下，包括 Webm(开源),不包括 x264、x265(版权原因)<ul>
<li>检查支持 在你的 QtWebEngine 程序中访问 chrome://media-internals 或 chrome://gpu 可以看到当前支持的解码格式。</li>
<li>在 QtWebEngine 程序中，访问:<ul>
<li><a href="https://www.webmfiles.org/demo-files/">https://www.webmfiles.org/demo-files/</a> 上传或播放 H264/H265 视频文件，测试支持性</li>
<li><a href="https://html5test.com/">https://html5test.com/</a></li>
<li><a href="https://webrtc.github.io/test-pages/">https://webrtc.github.io/test-pages/</a></li>
<li><a href="https://browserleaks.com/webrtc">https://browserleaks.com/webrtc</a></li>
</ul>
</li>
<li>重新编译QtWebEngine，包括相应解码器。 相关编译参数：<ul>
<li>-webengine-proprietary-codecs 启用专有编解码支持（H264、MP3、AAC 等）。</li>
<li>-webengine-ffmpeg 指定使用自定义 ffmpeg。 <pre class="fragment">./configure -webengine-proprietary-codecs
make -j$(nproc)
make install
</pre> </li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md145"></a>
[可选] IDE: Qt Creator。建议使用 v5.0.2 及以后版本，以前版本对 CMake 支持不够。</h3>
<pre class="fragment">  ~$ sudo apt install qtcreator
</pre> <h3><a class="anchor" id="autotoc_md146"></a>
OpenGL: 运行 Qt 需要</h3>
<pre class="fragment">  ~$ sudo apt install libglu1-mesa-dev
</pre> <h3><a class="anchor" id="autotoc_md147"></a>
Doxygen: &lt;a href="http://www.doxygen.nl/" &gt;http://www.doxygen.nl/&lt;/a&gt;</h3>
<pre class="fragment">  ~$ sudo apt install doxygen
</pre> <h2><a class="anchor" id="autotoc_md148"></a>
依赖库</h2>
<ul>
<li>[必选] 玉兔公共库: <a href="https://github.com/KangLin/RabbitCommon">https://github.com/KangLin/RabbitCommon</a></li>
<li>[必选] <a href="https://github.com/openssl/openssl">Openssl:</a> 运行 Qt 需要</li>
<li>[可选] FreeRDP: <a href="https://github.com/FreeRDP/FreeRDP">https://github.com/FreeRDP/FreeRDP</a></li>
<li>[可选] RFB<ul>
<li>[可选] RabbitVNC: <a href="https://github.com/KangLin/RabbitVNC">https://github.com/KangLin/RabbitVNC</a></li>
<li>[可选] LibVNCServer: <a href="https://github.com/LibVNC/libvncserver">https://github.com/LibVNC/libvncserver</a></li>
<li>[可选] TigerVNC: <a href="https://github.com/KangLin/tigervnc">https://github.com/KangLin/tigervnc</a></li>
</ul>
</li>
<li>[可选] QTermWidget: <a href="https://github.com/lxqt/qtermwidget">https://github.com/lxqt/qtermwidget</a></li>
<li>[可选] SSH<ul>
<li>libssh:<ul>
<li><a href="https://www.libssh.org/">https://www.libssh.org</a></li>
<li><a href="https://api.libssh.org/stable/index.html">libssh API</a></li>
</ul>
</li>
<li>libssh2:<ul>
<li><a href="https://www.libssh2.org/">https://www.libssh2.org</a></li>
<li><a href="https://github.com/libssh2/libssh2/">https://github.com/libssh2/libssh2</a></li>
</ul>
</li>
</ul>
</li>
<li>[可选] QtSsh: <a href="https://github.com/condo4/QtSsh.git">https://github.com/condo4/QtSsh.git</a></li>
<li>[可选] <a class="el" href="classQTelnet.html">QTelnet</a>: <a href="https://github.com/silderan/QTelnet.git">https://github.com/silderan/QTelnet.git</a></li>
<li>[可选] libtelnet: <a href="https://github.com/seanmiddleditch/libtelnet">https://github.com/seanmiddleditch/libtelnet</a></li>
<li>[可选] libdatachannel: <a href="https://github.com/paullouisageneau/libdatachannel">https://github.com/paullouisageneau/libdatachannel</a></li>
<li>[可选] QXmpp: <a href="https://github.com/qxmpp-project/qxmpp">https://github.com/qxmpp-project/qxmpp</a></li>
<li>[可选] QtService: <a href="https://github.com/KangLin/qt-solutions/">https://github.com/KangLin/qt-solutions/</a></li>
<li>[可选] PcapPlusPlus: <a href="https://github.com/seladb/PcapPlusPlus">https://github.com/seladb/PcapPlusPlus</a>。插件 WakeOnLan 需要。</li>
<li>[可选] FFMPEG: <a href="https://ffmpeg.org/">https://ffmpeg.org/</a>。 Qt 多媒体功能需要</li>
<li>[可选] qtkeychain: <a href="https://github.com/frankosterfeld/qtkeychain">https://github.com/frankosterfeld/qtkeychain</a></li>
<li>[可选] libcurl: <a href="https://curl.se">https://curl.se</a></li>
<li>[可选] QFtpServer: <a href="https://github.com/KangLin/QFtpServer">https://github.com/KangLin/QFtpServer</a></li>
</ul>
<h3><a class="anchor" id="autotoc_md149"></a>
玉兔公共库</h3>
<ul>
<li>此库默认放在与本项目同级目录下 <pre class="fragment">~$ git clone https://github.com/KangLin/RabbitRemoteControl.git
~$ git clone https://github.com/KangLin/RabbitCommon.git
</pre></li>
<li>如果没有在同级目录下，则必须指定 CMake 参数或者环境变量: <pre class="fragment">~$ git clone https://github.com/KangLin/RabbitRemoteControl.git
# 设置环境变量
~$ export RabbitCommon_ROOT=[RabbitCommon 安装目录]
~$ cd RabbitRemoteControl
# 或者设置 CMake 参数
~/RabbitRemoteControl$ cmake -DRabbitCommon_ROOT=[RabbitCommon 安装目录] ......
</pre> </li>
</ul>
<h3><a class="anchor" id="autotoc_md150"></a>
FreeRDP</h3>
<ul>
<li>使用系统预编译开发库 <pre class="fragment">~$ sudo apt install freerdp3-dev
</pre></li>
<li>使用 vcpkg<ul>
<li>源码位置: <a href="https://github.com/microsoft/vcpkg/">https://github.com/microsoft/vcpkg/</a> <pre class="fragment">~$ git clone https://github.com/microsoft/vcpkg.git
~$ cd vcpkg
~/vcpkg$ ./bootstrap-vcpkg.sh
~/vcpkg$ vcpkg install freerdp
</pre></li>
<li>指定 CMake 参数：-DCMAKE_TOOLCHAIN_FILE=[vcpkg 安装目录]/scripts/buildsystems/vcpkg.cmake</li>
<li>使用 vcpk ， FreeRDP 服务不是默认功能，所以需要你手动指定。</li>
</ul>
</li>
<li>从源码编译<ul>
<li>源码位置：https://github.com/FreeRDP/FreeRDP</li>
<li>编译详见：https://github.com/FreeRDP/FreeRDP/wiki/Compilation <pre class="fragment">  ~$ git clone https://github.com/FreeRDP/FreeRDP.git
  ~$ cd FreeRDP
  ~/FreeRDP$ mkdir build
  ~/FreeRDP/build$ cmake .. -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=`pwd`/install -DWITH_SERVER=ON
  ~/FreeRDP/build$ cmake --build . --config Release --target install
</pre></li>
</ul>
</li>
<li>当 FreeRDP 从源码编译时，编译本项需要指定的 CMake 参数：<ul>
<li>-DBUILD_FREERDP=ON</li>
<li>-DFreeRDP-Client_DIR=[freerdp 安装目录]/lib/cmake/FreeRDP-Client3</li>
<li>-DFreeRDP_DIR=[freerdp 安装目录]/lib/cmake/FreeRDP3</li>
<li>-DWinPR_DIR=[freerdp 安装目录]/lib/cmake/WinPR3</li>
<li>-DFreeRDP-Shadow_DIR=[freerdp 安装目录]/lib/cmake/FreeRDP-Shadow3</li>
<li>-DFreeRDP-Server_DIR=[freerdp 安装目录]/lib/cmake/FreeRDP-Server3</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md151"></a>
LibVNCServer</h3>
<ul>
<li>使用系统预编译开发库 <pre class="fragment">~$ sudo apt install libvncserver-dev
</pre></li>
<li>从源码编译<ul>
<li>源码位置：<a href="https://github.com/LibVNC/libvncserver">https://github.com/LibVNC/libvncserver</a></li>
</ul>
</li>
<li>当 LibVNCServer 从源码编译时，编译本项需要指定的 CMake 参数： <pre class="fragment">-DLibVNCServer_DIR=[LibVNCServer 安装目录]/lib/cmake/LibVNCServer
</pre> </li>
</ul>
<h3><a class="anchor" id="autotoc_md152"></a>
RabbitVNC</h3>
<ul>
<li>从源码编译<ul>
<li>源码位置: <a href="https://github.com/KangLin/RabbitVNC">https://github.com/KangLin/RabbitVNC</a> <br  />
 <pre class="fragment">~$ sudo apt install libpixman-1-dev
~$ git clone https://github.com/KangLin/RabbitVNC.git
~$ cd RabbitVNC
~/RabbitVNC$ mkdir build
~/RabbitVNC$ cmake .. -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=`pwd`/install
~/RabbitVNC$ cmake --build . --config Release --target install
</pre></li>
</ul>
</li>
<li>当 RabbitVNC 从源码编译时，编译本项需要指定的 CMake 参数： <pre class="fragment">-DRabbitVNC_DIR=[RabbitVNC 安装目录]/lib/cmake/RabbitVNC
</pre> </li>
</ul>
<h3><a class="anchor" id="autotoc_md153"></a>
TigerVNC</h3>
<ul>
<li>从源码编译</li>
</ul>
<p>官方只是个应用程序，不支持库。详见：https://github.com/TigerVNC/tigervnc/issues/1123 <br  />
 所以本人在官方基础上做了修改。源码位置：https://github.com/KangLin/tigervnc <br  />
 </p><pre class="fragment">~$ sudo apt install libpixman-1-dev
~$ git clone https://github.com/KangLin/tigervnc.git
~$ cd tigervnc
~/tigervnc$ mkdir build
~/tigervnc$ cmake .. -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=`pwd`/install
~/tigervnc$ cmake --build . --config Release --target install
</pre><ul>
<li>当 TigerVNC 从源码编译时，编译本项需要指定的 CMake 参数： <pre class="fragment">-Dtigervnc_DIR=[TigerVNC 安装目录]/lib/cmake/tigervnc
</pre> </li>
</ul>
<h3><a class="anchor" id="autotoc_md154"></a>
libdatachannel</h3>
<ul>
<li>使用 vcpkg<ul>
<li>源码位置: <a href="https://github.com/microsoft/vcpkg/">https://github.com/microsoft/vcpkg/</a> <pre class="fragment">~$ git clone https://github.com/microsoft/vcpkg.git
~$ cd vcpkg
~/vcpkg$ vcpkg install libdatachannel
</pre></li>
<li>指定 CMake 参数：-DCMAKE_TOOLCHAIN_FILE=[vcpkg 安装目录]/scripts/buildsystems/vcpkg.cmake</li>
</ul>
</li>
<li>从源码编译<ul>
<li>源码位置： <a href="https://github.com/paullouisageneau/libdatachannel">https://github.com/paullouisageneau/libdatachannel</a></li>
<li>编译详见： <a href="https://github.com/paullouisageneau/libdatachannel/blob/master/BUILDING.md">https://github.com/paullouisageneau/libdatachannel/blob/master/BUILDING.md</a> <pre class="fragment">~$ git clone https://github.com/paullouisageneau/libdatachannel.git
~$ cd libdatachannel
~/libdatachannel$ git submodule update --init --recursive
~/libdatachannel$ mkdir build
~/libdatachannel$ cd build
~/libdatachannel/build$ cmake .. -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=`pwd`/install
~/libdatachannel/build$ cmake --build . --config Release --target install
</pre></li>
</ul>
</li>
<li>当 libdatachannel 从源码编译时，编译本项需要指定的 CMake 参数： <pre class="fragment">-DLibDataChannel_DIR=[libdatachannel 安装目录]/lib/cmake/LibDataChannel
</pre> </li>
</ul>
<h3><a class="anchor" id="autotoc_md155"></a>
QXmpp</h3>
<ul>
<li>使用系统预编译开发库 <pre class="fragment">~$ sudo apt install libqxmpp-dev
</pre></li>
<li>从源码编译<ul>
<li>源码位置： <a href="https://github.com/qxmpp-project/qxmpp">https://github.com/qxmpp-project/qxmpp</a> <pre class="fragment">~$ git clone https://github.com/qxmpp-project/qxmpp.git
~$ cd qxmpp
~/qxmpp$ mkdir build
~/qxmpp$ cd build
~/qxmpp/build$ cmake .. -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=`pwd`/install -DQt5_DIR=[Qt5 安装目录]/lib/cmake/Qt5
~/qxmpp/build$ cmake --build . --config Release --target install
</pre></li>
</ul>
</li>
<li>当 QXmpp 从源码编译时，编译本项需要指定的 CMake 参数： <pre class="fragment">-DQXmpp_DIR=[QXmpp 安装目录]/lib/cmake/qxmpp
</pre> </li>
</ul>
<h3><a class="anchor" id="autotoc_md156"></a>
QTermWidget</h3>
<ul>
<li>使用系统预编译开发库 <pre class="fragment">~$ sudo apt install libqtermwidget5-0-dev
</pre></li>
<li>从源码编译<ul>
<li>源码位置： <a href="https://github.com/lxqt/qtermwidget">https://github.com/lxqt/qtermwidget</a></li>
</ul>
</li>
<li>当 QTermWidget 从源码编译时，编译本项需要指定的 CMake 参数： <pre class="fragment">-Dqtermwidget5_DIR=[qtermwidget 安装目录]/lib/cmake/qtermwidget5
</pre></li>
<li>安装时，需要复制资源到安装目录 <pre class="fragment">if [ -d "${INSTALL_DIR}/share/qtermwidget6" ]; then
    cp -r ${INSTALL_DIR}/share/qtermwidget6 ${INSTALL_APP_DIR}/share/
else
    echo "${INSTALL_DIR}/share/qtermwidget6 is not exist"
fi
</pre> </li>
</ul>
<h3><a class="anchor" id="autotoc_md157"></a>
libssh</h3>
<ul>
<li>使用系统预编译开发库 <pre class="fragment">~$ sudo apt install libssh-dev 
</pre></li>
<li>使用 vcpkg<ul>
<li>源码位置: <a href="https://github.com/microsoft/vcpkg/">https://github.com/microsoft/vcpkg/</a> <pre class="fragment">~$ git clone https://github.com/microsoft/vcpkg.git
~$ cd vcpkg
~/vcpkg$ vcpkg install libssh
</pre></li>
<li>指定 CMake 参数：-DCMAKE_TOOLCHAIN_FILE=[vcpkg 安装目录]/scripts/buildsystems/vcpkg.cmake</li>
</ul>
</li>
<li>从源码编译<ul>
<li>源码位置： <a href="https://www.libssh.org">https://www.libssh.org</a></li>
</ul>
</li>
<li>当 libssh 从源码编译时，编译本项需要指定的 CMake 参数： <pre class="fragment">-Dlibssh_DIR=[libssh 安装目录]/lib/cmake/libssh
</pre> </li>
</ul>
<h3><a class="anchor" id="autotoc_md158"></a>
QtService</h3>
<ul>
<li>从源码编译<ul>
<li>源码位置：: <a href="https://github.com/KangLin/qt-solutions/">https://github.com/KangLin/qt-solutions/</a> <pre class="fragment">~$ git clone https://github.com/KangLin/qt-solutions.git
~$ cd qt-solutions
~/qt-solutions$ mkdir build
~/qt-solutions$ cd build
~/qt-solutions/build$ cmake .. -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=`pwd`/install
~/qt-solutions/build$ cmake --build . --config Release --target install
</pre></li>
</ul>
</li>
<li>当 QtService 从源码编译时，编译本项需要指定的 CMake 参数： <pre class="fragment">-DQtService_DIR=[QtService 安装目录]/lib/cmake/QtService
</pre> </li>
</ul>
<h2><a class="anchor" id="autotoc_md159"></a>
PcapPlusPlus</h2>
<ul>
<li>从源码编译<ul>
<li>源码位置：https://github.com/seladb/PcapPlusPlus <pre class="fragment">~$ git clone https://github.com/seladb/PcapPlusPlus.git
</pre></li>
</ul>
</li>
<li>使用 vcpkg<ul>
<li>源码位置：https://github.com/microsoft/vcpkg/ <pre class="fragment">~$ git clone https://github.com/microsoft/vcpkg.git
~$ cd vcpkg
~/vcpkg$ ./vcpkg install pcapplusplus
</pre></li>
</ul>
</li>
<li>当 PcapPlusPlus 从源码编译时，编译本项需要指定的 CMake 参数： <pre class="fragment">-DPcapPlusPlus_DIR=[PcapPlusPlus 安装目录]/lib/cmake/pcapplusplus
</pre> </li>
</ul>
<h3><a class="anchor" id="autotoc_md160"></a>
libpcap</h3>
<p>PcapPlusPlus 依赖此库。</p>
<ul>
<li>使用系统预编译开发库 <pre class="fragment">~$ sudo apt install libpcap-dev
</pre></li>
<li>源码位置：https://github.com/the-tcpdump-group/libpcap</li>
</ul>
<h3><a class="anchor" id="autotoc_md161"></a>
QFtpServer</h3>
<ul>
<li>从源码编译<ul>
<li>源码位置： <a href="https://github.com/KangLin/QFtpServer">https://github.com/KangLin/QFtpServer</a> <pre class="fragment">~$ git clone https://github.com/KangLin/QFtpServer
</pre> </li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md162"></a>
编译本项目</h2>
<h3><a class="anchor" id="autotoc_md163"></a>
源码</h3>
<ul>
<li>项目位置：<a href="https://github.com/KangLin/RabbitRemoteControl">https://github.com/KangLin/RabbitRemoteControl</a></li>
<li>下载源码 <pre class="fragment">~$ git clone https://github.com/KangLin/RabbitRemoteControl.git
</pre> </li>
</ul>
<h3><a class="anchor" id="autotoc_md164"></a>
CMake 参数或者环境变量</h3>
<ul>
<li>CMake 参数或者环境变量<ul>
<li>Qt<ul>
<li>QT_ROOT: Qt 安装位置</li>
<li>Qt6: 详见：https://doc.qt.io/qt-6/cmake-get-started.html<ul>
<li>Qt6_ROOT: 与 QT_ROOT 相同</li>
<li>Qt6_DIR: $QT_ROOT/lib/cmake/Qt6</li>
</ul>
</li>
<li>Qt5: 详见：https://doc.qt.io/qt-6/cmake-get-started.html<ul>
<li>Qt5_ROOT: 与 QT_ROOT 相同</li>
<li>Qt5_DIR: $QT_ROOT/lib/cmake/Qt5</li>
</ul>
</li>
</ul>
</li>
<li>RabbitCommon_ROOT: RabbitCommon 源码位置</li>
<li>BUILD_CLIENT: 编译客户端。默认为 ON</li>
<li>BUILD_SERVICE: 编译服务器端。默认依赖是否有 QtService</li>
<li>BUILD_PLUGINS: 编译插件。默认为 ON</li>
<li>BUILD_APP: 编译应用程序。默认为 ON</li>
<li>BUILD_DOCS: 编译文档。默认为 OFF</li>
<li>BUILD_SHARED_LIBS: 编译动态库。默认为 ON</li>
<li>BUILD_FREERDP：是否编译 FreeRDP。 默认为 OFF</li>
<li>WinPR_DIR: [freerdp 安装目录]/lib/cmake/WinPR2</li>
<li>FreeRDP_DIR: [freerdp 安装目录]/lib/cmake/FreeRDP2</li>
<li>FreeRDP-Client_DIR: [freerdp 安装目录]/lib/cmake/FreeRDP-Client2</li>
<li>BUILD_RABBITVNC: 编译 RabbitVNC 插件。默认为 ON</li>
<li>RabbitVNC_DIR: [RabbitVNC 安装目录]/lib/cmake/RabbitVNC</li>
<li>BUILD_TigerVNC: 编译 TigerVNC。默认为 ON</li>
<li>tigervnc_DIR: [TigerVNC 安装目录]/lib/cmake/tigervnc</li>
<li>BUILD_LibVNCServer: 编译 LibVNCServer。默认为 ON</li>
<li>LibVNCServer_DIR: [libvncserver 安装目录]/lib/cmake/LibVNCServer</li>
<li>LibDataChannel_DIR: [libdatachannel 安装目录]/lib/cmake/LibDataChannel</li>
<li>QXmpp_DIR=[QXmpp 安装目录]/lib/cmake/qxmpp</li>
<li>qtermwidget5_DIR: [qtermwidget 安装目录]/lib/cmake/qtermwidget5</li>
<li>libssh_DIR: [libssh 安装目录]/lib/cmake/libssh</li>
<li>QtService_DIR: [QtService 安装目录]/lib/cmake/QtService</li>
</ul>
</li>
<li>如果使用 vcpkg，增加下面参数<ul>
<li>CMAKE_TOOLCHAIN_FILE: [vcpkg installation path]/scripts/buildsystems/vcpkg.cmake</li>
<li>VCPKG_MANIFEST_FEATURES: vcpkg 中的清单功能</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md165"></a>
编译</h3>
<ul>
<li>命令行编译<ul>
<li>不用 vcpkg <pre class="fragment">~$ cd RabbitRemoteControl
~/RabbitRemoteControl$ mkdir build
~/RabbitRemoteControl/build$ cmake .. -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=`pwd`/install 
~/RabbitRemoteControl/build$ cmake --build . --config Release --target install
</pre></li>
<li>使用 vcpkg <pre class="fragment">~$ cd RabbitRemoteControl
~/RabbitRemoteControl$ mkdir build
~/RabbitRemoteControl/build$ cmake .. -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=`pwd`/install \
    -DCMAKE_TOOLCHAIN_FILE=[vcpkg installation path]/scripts/buildsystems/vcpkg.cmake \
    [可选依赖库]
~/RabbitRemoteControl/build$ cmake --build . --config Release --target install
</pre></li>
</ul>
</li>
<li>IDE(Qt Creator) 编译<ul>
<li>打开项目: “菜单→文件→打开文件或项目”，选择项目根目录中的 CMakeLists.txt</li>
<li>配置：点左侧工具栏上的 “项目→构建与运行”，配置 CMake 参数<ul>
<li>如果要安装，还需要　“项目→构建与运行→构建步骤→目标”　中，选中　install</li>
</ul>
</li>
<li>编译与运行： 点左侧工具栏上的 “开始调试” 或者按快捷键 “F5”</li>
<li>如果用 vcpkg: 选项→Kits→Cmake Configureration: 增加 CMAKE_TOOLCHAIN_FILE=[vcpkg installation path]/scripts/buildsystems/vcpkg.cmake</li>
</ul>
</li>
<li>使用脚本 <a href="../../Script/build_debpackage.sh">build_debpackage.sh</a><ul>
<li>设置 CMake 参数或者环境变量为环境变量。例如： <pre class="fragment">export RabbitVNC_DIR=[RabbitVNC 安装目录]/lib/cmake/RabbitVNC
export tigervnc_DIR=[TigerVNC 安装目录]/lib/cmake/tigervnc
export QtService_DIR=[QtService 安装目录]/lib/cmake/QtService
</pre></li>
<li>使用脚本 <a href="../../Script/build_debpackage.sh">build_debpackage.sh</a> <pre class="fragment">./Script/build_debpackage.sh [$QT_ROOT] [$RabbitCommon_ROOT]
</pre> </li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md166"></a>
运行</h3>
<ul>
<li>程序安装在 install/bin 下 <pre class="fragment">~$ cd RabbitRemoteControl
~/RabbitRemoteControl$ cd build/install/bin
~/RabbitRemoteControl$ ./RabbitRemoteControl.sh
# 或者
~/RabbitRemoteControl$ ./RabbitRemoteControlApp
</pre> <b>注意：</b> 如果插件没有加载。则可能是插件的依赖库没有安装到系统。 你可以把依赖库的目录加入到环境变量 LD_LIBRARY_PATH 中。 你也可以把依赖库的目录加入到 /etc/ld.so.conf 文件中， 然后运行 ldconfig 把依赖库加入到系统中。</li>
<li>Qt 变量<ul>
<li><p class="startli">QT_DEBUG_PLUGINS: 调试插件</p>
<p class="startli"><code>export QT_DEBUG_PLUGINS=1</code></p>
</li>
<li>QT_QPA_PLATFORM: 加载指定的平台。例如使用 <a href="https://github.com/qt-rick/qtbase-vnc-platform-plug">vnc</a> <pre class="fragment">export QT_QPA_PLATFORM=vnc
</pre> </li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md167"></a>
编译例子</h2>
<h3><a class="anchor" id="autotoc_md168"></a>
Ubuntu</h3>
<pre class="fragment">```bash
# 安装开发工具软件包
~$ sudo apt install build-essential
# 安装工具
~$ sudo apt install git cmake debhelper doxygen
# [可选] 安装 Qt5
~$ sudo apt install qttools5-dev qttools5-dev-tools qtbase5-dev \
    qtbase5-dev-tools qtmultimedia5-dev qtlocation5-dev libqt5svg5-dev \
    libqtermwidget5-0-dev
# 安装 X 开发库
~$ sudo apt install libxkbcommon-dev libxkbcommon-x11-dev libx11-xcb-dev \
    libx11-dev libxfixes-dev
~$ sudo apt install libutf8proc-dev libpam0g-dev #编译 qtermwidget 需要
# 安装依赖库
~$ sudo apt install freerdp2-dev libvncserver-dev libssh-dev libtelnet-dev
~$ sudo apt install debhelper fakeroot
# 安装 pixman ,RabbitVNC 和 TigerVNC 需要它
~$ sudo apt install libpixman-1-dev
# 编译 RabbitVNC
~$ git clone https://github.com/KangLin/RabbitVNC.git
~$ cd RabbitVNC
~$ mkdir build
~/RabbitVNC/build$ cmake .. -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=`pwd`/install
~/RabbitVNC/build$ cmake --build . --config Release --target install
~/RabbitVNC/build$ cd ~
# 编译 TigerVNC
~$ git clone https://github.com/KangLin/tigervnc.git
~$ cd tigervnc
~$ mkdir build
~/tigervnc/build$ cmake .. -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=`pwd`/install
~/tigervnc/build$ cmake --build . --config Release --target install
~/tigervnc/build$ cd ~
~$ sudo apt install libqxmpp-dev
# 编译 libdatachannel
~$ git clone https://github.com/paullouisageneau/libdatachannel.git
~$ cd libdatachannel
~/libdatachannel$ git submodule update --init --recursive
~/libdatachannel$ mkdir build
~/libdatachannel$ cd build
~/libdatachannel/build$ cmake .. -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=`pwd`/install
~/libdatachannel/build$ cmake --build . --config Release --target install
~/libdatachannel/build$ cd ~
# 编译 QtService
~$ git clone https://github.com/KangLin/qt-solutions.git
~$ cd qt-solutions/qtservice
~/qt-solutions/qtservice$ mkdir build
~/qt-solutions/qtservice$ cd build
~/qt-solutions/qtservice/build$ cmake .. -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=`pwd`/install
~/qt-solutions/qtservice/build$ cmake --build . --config Release --target install
~/qt-solutions/qtservice/build$ cd ~
~$ git clone https://github.com/KangLin/RabbitCommon.git
~$ git clone https://github.com/KangLin/RabbitRemoteControl.git
~$ cd RabbitRemoteControl
~/RabbitRemoteControl$ mkdir build
~/RabbitRemoteControl$ cd build
~/RabbitRemoteControl/build$ cmake .. -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=`pwd`/install \
    -DBUILD_FREERDP=ON \
    -DRabbitVNC_DIR=~/RabbitVNC/build/install/lib/cmake/RabbitVNC \
    -Dtigervnc_DIR=~/tigervnc/build/install/lib/cmake/tigervnc \
    -DLibDataChannel_DIR=~/libdatachannel/build/install/lib/cmake/LibDataChannel \
    -DQtService_DIR=~/qt-solutions/qtservice/build/lib/cmake/QtService
~/RabbitRemoteControl/build$ cmake --build . --config Release --target install
```
</pre><p> 详见：脚本</p>
<h2><a class="anchor" id="autotoc_md169"></a>
&lt;a href="https://github.com/linuxdeploy/linuxdeploy" &gt;AppImage&lt;/a&gt;</h2>
<ul>
<li>构建 <pre class="fragment">~/RabbitRemoteControl/build$ cmake .. \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMARK_SHARED=OFF \
    -DCMARK_TESTS=OFF \
    -DCMARK_STATIC=ON \
    -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DBUILD_QUIWidget=OFF \
    -DBUILD_APP=ON \
    -DBUILD_FREERDP=ON
cmake --build . --parallel $(nproc)
cmake --install . --config Release --component DependLibraries --prefix AppDir/usr
cmake --install . --config Release --component Runtime --prefix AppDir/usr
cmake --install . --config Release --component Application --prefix AppDir/usr
cmake --install . --config Release --component Plugin --prefix AppDir/usr
</pre></li>
<li>建立 AppImage <pre class="fragment"># See: https://github.com/linuxdeploy/linuxdeploy-plugin-qt
#export QMAKE=${QT_ROOT}/bin/qmake
export EXTRA_PLATFORM_PLUGINS="libqxcb.so"
# Icons from theme are not displayed in QtWidgets Application: https://github.com/linuxdeploy/linuxdeploy-plugin-qt/issues/17
export EXTRA_QT_MODULES="svg"
./linuxdeploy-`uname -m`.AppImage --appdir=AppDir -v0 \
    --deploy-deps-only=AppDir/usr/plugins/Client \
    --deploy-deps-only=AppDir/usr/lib/`uname -m`-linux-gnu \
    --plugin qt \
    --output appimage
</pre></li>
<li>运行 <pre class="fragment">sudo chmod u+x ./Rabbit_Remote_Control-`uname -m`.AppImage
./Rabbit_Remote_Control-`uname -m`.AppImage
</pre></li>
<li>其它<ul>
<li>解压 AppImage <pre class="fragment">./Rabbit_Remote_Control-`uname -m`.AppImage --appimage-extract # 解压 AppImage 文件
</pre></li>
<li><p class="startli">FUSE 问题</p>
<p class="startli">第一次执行AppImage文件的时候可能会碰到 PUSE 相关的问题，报错如下：</p>
<div class="fragment"><div class="line">dlopen(): error loading libfuse.so.2</div>
<div class="line"> </div>
<div class="line">AppImages require FUSE to run.</div>
<div class="line">You might still be able to extract the contents of this AppImage</div>
<div class="line">if you run it with the --appimage-extract option.</div>
<div class="line">See https://github.com/AppImage/AppImageKit/wiki/FUSE</div>
<div class="line"> </div>
<div class="line">for more information</div>
</div><!-- fragment --><p class="startli">解决方案：安装 fuse2 </p><pre class="fragment">sudo apt install fuse
</pre></li>
<li><p class="startli">在 docker 中运行时出现 FUSE 错误</p>
<p class="startli">在创建容器的时候加上参数: <code>--privileged</code> </p><pre class="fragment">docker run --privileged --interactive ubuntu
</pre></li>
</ul>
</li>
<li>脚本：<a href="../../Script/build_appimage.sh">build_appimage.sh</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md170"></a>
snap</h2>
<ul>
<li>安装 snapcraft <pre class="fragment">sudo snap install snapcraft --classic
</pre><ul>
<li>通过检查版本号来验证 Snapcraft 是否已安装。 <pre class="fragment">snapcraft --version
</pre></li>
<li>把当前用户加入 lxd 组 <pre class="fragment">sudo usermod -aG lxd $USER
</pre></li>
<li>如果系统已安装了 docker, 则用下列方法设置：<ul>
<li>允许 ipv4 转发 <pre class="fragment">sudo echo "net.ipv4.conf.all.forwarding=1" &gt; /etc/sysctl.d/99-forwarding.conf
sudo systemctl restart systemd-sysctl
</pre></li>
<li>允许出口网络流量 <pre class="fragment">sudo iptables  -I DOCKER-USER -i &lt;network_bridge&gt; -j ACCEPT
sudo ip6tables -I DOCKER-USER -i &lt;network_bridge&gt; -j ACCEPT
sudo iptables  -I DOCKER-USER -o &lt;network_bridge&gt; -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
sudo ip6tables -I DOCKER-USER -o &lt;network_bridge&gt; -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT

# 如果 lxd 接口名为 lxdbr0

sudo iptables  -I DOCKER-USER -i lxdbr0 -j ACCEPT
sudo ip6tables -I DOCKER-USER -i lxdbr0 -j ACCEPT
sudo iptables  -I DOCKER-USER -o lxdbr0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
sudo ip6tables -I DOCKER-USER -o lxdbr0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
</pre></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>参考: <a href="https://documentation.ubuntu.com/lxd/en/latest/howto/network_bridge_firewalld/#prevent-connectivity-issues-with-lxd-and-docker">https://documentation.ubuntu.com/lxd/en/latest/howto/network_bridge_firewalld/#prevent-connectivity-issues-with-lxd-and-docker</a></p>
<ul>
<li>构建:<ul>
<li><a href="https://snapcraft.io/docs/create-a-new-snap">建立新的 snap</a></li>
<li>Parts 生命周期: <a href="https://snapcraft.io/docs/parts-lifecycle">https://snapcraft.io/docs/parts-lifecycle</a></li>
<li><p class="startli"><a href="https://snapcraft.io/docs/how-snapcraft-builds">https://snapcraft.io/docs/how-snapcraft-builds</a> </p><pre class="fragment">~$ git clone https://github.com/KangLin/RabbitRemoteControl.git
~$ cd RabbitRemoteControl
~$ snapcraft -v 
</pre><p> 这些生命周期步骤中的每一个都可以从命令行运行， 并且该命令可以是特定于部件的命令，也可以是应用于项目中的所有部件的命令。</p>
<div class="fragment"><div class="line">snapcraft pull [&lt;part-name&gt;]</div>
<div class="line">snapcraft build [&lt;part-name&gt;]</div>
<div class="line">snapcraft stage [&lt;part-name&gt;]</div>
<div class="line">snapcraft prime [&lt;part-name&gt;]</div>
<div class="line">snapcraft pack or snapcraft</div>
</div><!-- fragment --></li>
<li>迭代构建: <a href="https://snapcraft.io/docs/iterating-over-a-build">https://snapcraft.io/docs/iterating-over-a-build</a> 通过以下命令，您可以单步执行此封装环境：<ul>
<li>&ndash;shell：将快照构建到指定之前的生命周期步骤，并在环境中打开一个 shell 例如，运行 snapcraft prime [&lt;part-name&gt;] &ndash;shell 将运行到暂存步骤并打开一个 shell）。</li>
<li>&ndash;shell-after：构建对指定生命周期步骤的快照，并在环境中打开 shell。 （例如，运行 snapcraft prime [&lt;part-name&gt;] &ndash;shell-after 将运行到 prime 步骤，然后进入 shell）。</li>
<li>&ndash;debug 在发生错误后在环境中打开一个 shell。</li>
<li>-v: 显示构建动作 <pre class="fragment">$ # 例如 prime freerdp
$ snapcraft prime freerdp --shell-after -v --debug
</pre></li>
</ul>
</li>
<li>清理 <pre class="fragment">snapcraft clean
</pre></li>
</ul>
</li>
<li>调试<ul>
<li>开发模式安装 （&ndash;devmode）。未签名的。 <pre class="fragment">snap install ./rabbitremotecontrol_0.0.27_amd64.snap --devmode
</pre></li>
<li>运行 <pre class="fragment">rabbitremotecontrol
</pre></li>
<li>卸载 <pre class="fragment">snap remove rabbitremotecontrol
</pre></li>
</ul>
</li>
<li>参考：<ul>
<li><a href="https://cn.linux-terminal.com/?p=1776">如何在 Linux 上安装和使用 Snapcraft</a></li>
</ul>
</li>
<li>问题：<ul>
<li>运行时，出现下列错误： <pre class="fragment">[27470:27470:1015/151510.941749:FATAL:credentials.cc(130)] Check failed: . : Permission denied (13)
追踪或断点陷阱 (核心已转储)
</pre> 这是因为 Qt WebEngine 没有访问系统凭据的权限导致的。解决方案： <pre class="fragment">export QTWEBENGINE_CHROMIUM_FLAGS="--no-sandbox" &amp;&amp; rabbitremotecontrol
# 或者：
export QTWEBENGINE_DISABLE_SANDBOX=1 &amp;&amp; rabbitremotecontrol
</pre> </li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md171"></a>
Flatpak</h2>
<ul>
<li>准备<ul>
<li>安装构建和运行 flatpak 所需的软件：flatpak 和 flatpak-builder<ul>
<li>在 Fedora 上我们必须运行： <pre class="fragment">$ sudo dnf install flatpak flatpak-builder
# 其它工具
$ sudo dnf install autogen git cmake gcc autoconf
</pre></li>
<li>在 Debian/Ubuntu 或基于它的众多发行版之一上： <pre class="fragment">$ sudo apt-get update &amp;&amp; sudo apt-get install flatpak flatpak-builder
</pre></li>
<li>在 Archlinux 上我们可以使用 pacman 来执行相同的操作： <pre class="fragment">$ sudo pacman -Sy flatpak flatpak-builder
</pre></li>
</ul>
</li>
<li>添加 <a href="https://flathub.org/">Flathub</a> 仓库： <pre class="fragment">$ flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
</pre><ul>
<li>中科大镜像： <pre class="fragment">$flatpak remote-modify flathub --url=https://mirrors.ustc.edu.cn/flathub
</pre></li>
<li>上海交大镜像： <pre class="fragment">$flatpak remote-modify flathub --url=https://mirror.sjtu.edu.cn/flathub
</pre></li>
<li>查看flatpak仓库的详细信息 <pre class="fragment">$ flatpak remotes --show-details
</pre></li>
</ul>
</li>
<li>参考<ul>
<li><a href="https://www.cnblogs.com/lwlnice/p/18263967">Linux捣鼓记录：安装flatpak软件仓库，更换国内镜像</a></li>
</ul>
</li>
</ul>
</li>
<li>构建 <pre class="fragment">$ cd RabbitRemoteControl
$ flatpak-builder build-dir Package/Flatpak/io.github.KangLin.RabbitRemoteControl.yml
** (flatpak-builder:37): WARNING **: 03:05:45.408: Unknown property branch for type BuilderSourceDir
error: org.kde.Sdk/x86_64/6.8 not installed
Failed to init: Unable to find sdk org.kde.Sdk version 6.8
</pre> 提示 sdk 没有安装。指定的运行时和 sdk 不会自动安装，我们必须手动安装。 要仅为我们的用户从 flathub 存储库安装它们，我们使用以下命令： <pre class="fragment">$ flatpak install org.kde.Sdk//6.8 org.kde.Platform//6.8
</pre> 安装完所有的 sdk 和运行库后，再构建： <pre class="fragment">$ flatpak-builder --force-clean build-dir Package/Flatpak/io.github.KangLin.RabbitRemoteControl.yml
# 或者 用户模式
$ flatpak-builder --user --force-clean build-dir Package/Flatpak/io.github.KangLin.RabbitRemoteControl.yml
</pre> **请注意**，我们在此处使用 &ndash;user 选项以安装应用程序在当前用户范围内。 如果您愿意，可以忽略此选项，则安装应用程序在系统范围内。</li>
</ul>
<p>编译目录位于当前目录下：.flatpak-builder</p>
<ul>
<li>进入构建沙盒环境 <pre class="fragment">$ flatpak-builder --run build-dir Package/Flatpak/io.github.KangLin.RabbitRemoteControl.yml bash
</pre></li>
</ul>
<p>安装</p>
<p>应用程序构建完成，我们就可以安装它。我们所要做的就是运行以下命令： </p><pre class="fragment">$ flatpak-builder --force-clean --install build-dir Package/Flatpak/io.github.KangLin.RabbitRemoteControl.yml
# 或者 用户模式
$ flatpak-builder --user --force-clean --install build-dir Package/Flatpak/io.github.KangLin.RabbitRemoteControl.yml
</pre><ul>
<li>运行 <pre class="fragment">$ flatpak run io.github.KangLin.RabbitRemoteControl
</pre></li>
<li>创建存储库</li>
</ul>
<p>如果到目前为止一切都按预期工作，我们可以继续将我们的应用程序放入存储库中。 在这里，我们将创建自己的存储库，但如果您想将应用程序上线， 则需要按照要上传到的网站（例如 FlatHub）的提交说明进行操作。 我们将再次构建应用程序，但这次添加 &ndash;repo 选项。我们将我们的存储库称为“Rabbit”。 </p><pre class="fragment">$ flatpak-builder --user --repo=Rabbit --force-clean build-dir Package/Flatpak/io.github.KangLin.RabbitRemoteControl.yml
</pre><ul>
<li>添加到 Flatpak</li>
</ul>
<p>接下来，我们可以将新存储库添加到 Flatpak，然后从存储库安装我们的应用程序。 </p><pre class="fragment">$ flatpak --user remote-add --no-gpg-verify Rabbit Rabbit
$ flatpak --user install Rabbit io.github.KangLin.RabbitRemoteControl
</pre><p> **请注意**，我们在此处使用 &ndash;user 选项以避免安装应用程序以供系统范围使用。如果您愿意，可以忽略此选项。</p>
<ul>
<li>另外，如果生成 .flatpak 文件。则可以直接安装 .flatpak 文件 <pre class="fragment">$ flatpak --user install RabbitRemoteControl_v0.0.32_Linux_x86_64.flatpak
</pre></li>
<li>添加元信息<ul>
<li>文件名：<code>&lt;app-id&gt;.metainfo.xml</code> <pre class="fragment">io.github.KangLin.RabbitRemoteControl.metainfo.xml
</pre></li>
<li>文件位置： <pre class="fragment">/app/share/metainfo
</pre></li>
<li>验证 XML 语法： <pre class="fragment"># 安装验证工具
sudo apt install appstream-util  # Debian/Ubuntu
sudo dnf install appstream-util  # Fedora
# 验证 XML 语法
appstream-util validate-relax io.github.KangLin.RabbitRemoteControl.metainfo.xml
</pre></li>
<li>验证元数据文件 构建后检查文件是否被正确安装： <pre class="fragment"># 进入构建沙盒环境
flatpak-builder --run build-dir Package/Flatpak/io.github.KangLin.RabbitRemoteControl.yml bash

# 在沙盒中检查路径
ls -l /app/share/metainfo/io.github.KangLin.RabbitRemoteControl.metainfo.xml
</pre></li>
</ul>
</li>
<li>问题<ul>
<li>在 docker 中运行时出现 FUSE 错误 <pre class="fragment">Initializing build dir
Committing stage init to cache
Starting build of io.github.KangLin.RabbitRemoteControl
fuse: device not found, try 'modprobe fuse' first
Error: Failure spawning rofiles-fuse, exit_status: 1024
</pre> 在创建容器的时候加上参数: <code>--privileged</code> <pre class="fragment">docker run --privileged --interactive fedora
</pre></li>
<li>在 docker 中，运行程序出现下面错误： <pre class="fragment">[root@de5245ca3cfc Download]# flatpak run io.github.KangLin.RabbitRemoteControl
App.Main: QT_QPA_PLATFORM: ""
Current Qt Platform is: "xcb" ; This can be modified with the environment variables QT_QPA_PLATFORM:
 export QT_QPA_PLATFORM=xcb
 Optional: xcb; vnc
qt.qpa.xcb: could not connect to display
qt.qpa.plugin: From 6.5.0, xcb-cursor0 or libxcb-cursor0 is needed to load the Qt xcb platform plugin.
qt.qpa.plugin: Could not load the Qt platform plugin "xcb" in "" even though it was found.
This application failed to start because no Qt platform plugin could be initialized. Reinstalling the application may fix this problem.

Available platform plugins are: offscreen, vnc, xcb, wayland, minimal, wayland-egl, eglfs, minimalegl, linuxfb, vkkhrdisplay.
</pre> 原因是由于没有安装桌面系统。所以安装 xvfb <pre class="fragment">sudo dnf install xorg-x11-server-Xvfb
sudo Xvfb :99 -ac -screen 0 1200x900x24 &amp;
export DISPLAY=:99.0
</pre></li>
<li>QtWebEngine: <a href="https://github.com/flathub/io.qt.qtwebengine.BaseApp">https://github.com/flathub/io.qt.qtwebengine.BaseApp</a></li>
</ul>
</li>
<li>文档<ul>
<li><a href="https://docs.flatpak.org/en/latest/flatpak-builder-command-reference.html#flatpak-manifest">flatpak 清单文件</a></li>
<li><a href="https://docs.flatpak.org/en/latest/sandbox-permissions.html">Sandbox 权限</a></li>
<li><a href="https://docs.flathub.org/docs/for-app-authors/submission">提交到 Flathub</a></li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md172"></a>
rpm 包</h2>
<ul>
<li>安装 rpm-build 的相关 rpm 包 <pre class="fragment">dnf -y install rpm-build rpmdevtools
</pre></li>
<li>生成打包目录结构 <pre class="fragment">[root@111c5317c4e6 /]# rpmdev-setuptree
[root@111c5317c4e6 ~]# ls -a
.   .bash_logout   .bashrc  .cshrc  .rpmmacros  .tcshrc   rpmbuild
..  .bash_profile  .cache   .local  .ssh        .viminfo
[root@111c5317c4e6 /]# cd /root/rpmbuild/
[root@111c5317c4e6 rpmbuild]# ls
BUILD  RPMS  SOURCES  SPECS  SRPMS
</pre><ul>
<li>目录解释：<ul>
<li>BUILD：源码解压后存放的目录</li>
<li>RPMS：制作完成后的RPM存放目录</li>
<li>SOURCES：存放源文件，配置文件，补丁文件等放置的目录</li>
<li>SPECS：存放SPEC文件，制作RPM包的目录</li>
<li>SRPMS：src格式的RPM包目录</li>
</ul>
</li>
</ul>
</li>
<li>可以通过如下的命令查看工作目录的路径： <pre class="fragment">  [root@111c5317c4e6 ~]# rpmbuild --showrc | grep topdir
  -13: _builddir  %{_topdir}/BUILD
  -13: _rpmdir    %{_topdir}/RPMS
  -13: _sourcedir %{_topdir}/SOURCES
  -13: _specdir   %{_topdir}/SPECS
  -13: _srcrpmdir %{_topdir}/SRPMS
  -13: _topdir    %(echo $HOME)/rpmbuild
</pre> </li>
</ul>
<h2><a class="anchor" id="autotoc_md173"></a>
脚本</h2>
<ul>
<li>构建脚本<ul>
<li><a href="../../Script/build_linux.sh">build_linux.sh</a>: 构建本项目。</li>
<li><a href="../../Script/common.sh">common.sh</a>: 公共函数。</li>
<li><a href="../../Script/build_depend.sh">build_depend.sh</a>: 构建、安装依赖库。</li>
<li><a href="../../Script/build_debpackage.sh">build_debpackage.sh</a>: 构建 deb 安装包。 执行前，请设置环境变量。参见：CMake 参数或者环境变量 　- <a href="../../Script/build_rpm_package.sh">build_rpm_package.sh</a>: 构建 deb 安装包。 执行前，请设置环境变量。参见：CMake 参数或者环境变量</li>
<li><a href="../../Script/build_appimage.sh">build_appimage.sh</a>: 构建 AppImage 包。 执行前，请设置环境变量。参见：CMake 参数或者环境变量</li>
<li>示例<ul>
<li>使用 build_linux.sh <pre class="fragment"># 仅构建 AppImage
./Script/build_linux.sh --appimage
# 仅构建 deb 包
./Script/build_linux.sh --deb
# 仅编译 rpm 包
./Script/build_linux.sh --rpm
# 如果同时构建 deb、rpm 包和 AppImage，请用 docker 。否则 qt 可能会产生污染。
./Script/build_linux.sh --docker --deb --appimage --rpm
</pre></li>
<li>分步构建 <pre class="fragment"># 如果是从 [Qt官网](download.qt.io) 安装的 Qt
export QT_ROOT=
export Qt6_ROOT=$QT_ROOT
export QMAKE=$QT_ROOT/bin/qmake
# 如果是系统自带的 Qt
export QT_SELECT=qt6

# 注意：下面环境变量一定要使用绝对路径
export BUILD_DIR=`pwd`/build
export INSTALL_DIR=$BUILD_DIR/install
export SOURCE_DIR=$BUILD_DIR/source
export TOOLS_DIR=$BUILD_DIR/tools

# 安装依赖库
sudo ./Script/build_depend.sh --apt_update --base --default --rabbitcommon \
    --tigervnc --pcapplusplus \
    --install ${INSTALL_DIR} \
    --source ${SOURCE_DIR} \
    --tools ${TOOLS_DIR} \
    --build ${BUILD_DIR}

# 设置环境变量
export RabbitCommon_ROOT=${SOURCE_DIR}/RabbitCommon
export tigervnc_DIR=${INSTALL_DIR}/lib/cmake/tigervnc
export PcapPlusPlus_DIR=${INSTALL_DIR}/lib/cmake/pcapplusplus

# 构建 deb 包
./Script/build_debpackage.sh

# 构建 AppImage
./Script/build_appimage.sh
</pre></li>
</ul>
</li>
</ul>
</li>
<li><a href="../../deploy.sh">deploy.sh</a>: 分发版本。仅由管理员使用。 </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.16-->
<!-- start footer part -->
<hr class="footer"/><address class="footer">
<a href="mailto:kl222@126.com" >Author: Kang Lin (kl222@126.com)</a>
<p/>
<a href="https://github.com/KangLin/LunarCalendar">Copyright (c) Kang Lin Studios All Rights Reserved</a>
</address>
</body>
</html>
